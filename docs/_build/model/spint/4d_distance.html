---
redirect_from:
  - "/model/spint/4d-distance"
interact_link: content/model/spint/4d_distance.ipynb
kernel_name: Python [Root]
has_widgets: false
title: '4d_distance'
prev_page:
  url: /model/spint/intro.html
  title: 'spint'
next_page:
  url: /model/spint/autograd_test.html
  title: 'autograd_test'
comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span> <span class="kn">as</span> <span class="nn">spatial</span>
<span class="kn">from</span> <span class="nn">pysal.weights</span> <span class="kn">import</span> <span class="n">W</span>
<span class="kn">from</span> <span class="nn">pysal.weights.util</span> <span class="kn">import</span> <span class="n">isKDTree</span>
<span class="kn">from</span> <span class="nn">pysal.weights</span> <span class="kn">import</span> <span class="n">Distance</span> <span class="k">as</span> <span class="n">Distance</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">nplinalg</span><span class="p">():</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
<span class="k">def</span> <span class="nf">eucdist</span><span class="p">():</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">distance</span><span class="o">.</span><span class="n">euclidean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
<span class="k">def</span> <span class="nf">distpython</span><span class="p">():</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">84</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">53</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">67</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">67</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">44</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>
    <span class="n">dist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">30</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">)))</span>

<span class="k">def</span> <span class="nf">scpkdtree</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">DistanceBand</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> nplinalg()
<span class="o">%</span><span class="k">timeit</span> distpython()
<span class="o">%</span><span class="k">timeit</span> scpkdtree()
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The slowest run took 144.28 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 86.8 µs per loop
The slowest run took 17.86 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 82.1 µs per loop
The slowest run took 5.82 times longer than the fastest. This could mean that an intermediate result is being cached.
1 loop, best of 3: 40min 50s per loop
</pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">pysal</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">DistanceBand</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-371-25b6bf1123d8&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> data <span class="ansi-blue-fg">=</span> zip<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> w<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> z<span class="ansi-blue-fg">.</span>ravel<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> tree <span class="ansi-blue-fg">=</span> spatial<span class="ansi-blue-fg">.</span>KDTree<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>W <span class="ansi-blue-fg">=</span> pysal<span class="ansi-blue-fg">.</span>weights<span class="ansi-blue-fg">.</span>DistanceBand<span class="ansi-blue-fg">(</span>tree<span class="ansi-blue-fg">,</span> threshold<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">9999</span><span class="ansi-blue-fg">,</span> alpha<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">-</span><span class="ansi-cyan-fg">1.5</span><span class="ansi-blue-fg">,</span> binary<span class="ansi-blue-fg">=</span>False<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">//anaconda/lib/python2.7/site-packages/pysal/weights/Distance.pyc</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, data, threshold, p, alpha, binary, ids)</span>
<span class="ansi-green-intense-fg ansi-bold">    472</span>         self<span class="ansi-blue-fg">.</span>alpha <span class="ansi-blue-fg">=</span> alpha
<span class="ansi-green-intense-fg ansi-bold">    473</span>         self<span class="ansi-blue-fg">.</span>_band<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 474</span><span class="ansi-red-fg">         </span>neighbors<span class="ansi-blue-fg">,</span> weights <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_distance_to_W<span class="ansi-blue-fg">(</span>ids<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    475</span>         W<span class="ansi-blue-fg">.</span>__init__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> neighbors<span class="ansi-blue-fg">,</span> weights<span class="ansi-blue-fg">,</span> ids<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    476</span> 

<span class="ansi-green-fg">//anaconda/lib/python2.7/site-packages/pysal/weights/Distance.pyc</span> in <span class="ansi-cyan-fg">_distance_to_W</span><span class="ansi-blue-fg">(self, ids)</span>
<span class="ansi-green-intense-fg ansi-bold">    504</span>                 i<span class="ansi-blue-fg">,</span>j <span class="ansi-blue-fg">=</span> key
<span class="ansi-green-intense-fg ansi-bold">    505</span>                 <span class="ansi-green-fg">if</span> i <span class="ansi-blue-fg">!=</span> j<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 506</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">if</span> j <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">in</span> neighbors<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    507</span>                         weights<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>weight<span class="ansi-blue-fg">**</span>self<span class="ansi-blue-fg">.</span>alpha<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    508</span>                         neighbors<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>j<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">class</span> <span class="nc">DistanceBand</span><span class="p">(</span><span class="n">W</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Spatial weights based on distance band.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    data        : array</span>
<span class="sd">                  (n,k) or KDTree where KDtree.data is array (n,k)</span>
<span class="sd">                  n observations on k characteristics used to measure</span>
<span class="sd">                  distances between the n objects</span>
<span class="sd">    threshold  : float</span>
<span class="sd">                 distance band</span>
<span class="sd">    p          : float</span>
<span class="sd">                 Minkowski p-norm distance metric parameter:</span>
<span class="sd">                 1&lt;=p&lt;=infinity</span>
<span class="sd">                 2: Euclidean distance</span>
<span class="sd">                 1: Manhattan distance</span>
<span class="sd">    binary     : boolean</span>
<span class="sd">                 If true w_{ij}=1 if d_{i,j}&lt;=threshold, otherwise w_{i,j}=0</span>
<span class="sd">                 If false wij=dij^{alpha}</span>
<span class="sd">    alpha      : float</span>
<span class="sd">                 distance decay parameter for weight (default -1.0)</span>
<span class="sd">                 if alpha is positive the weights will not decline with</span>
<span class="sd">                 distance. If binary is True, alpha is ignored</span>

<span class="sd">    ids         : list</span>
<span class="sd">                  values to use for keys of the neighbors and weights dicts</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    weights : dict</span>
<span class="sd">              of neighbor weights keyed by observation id</span>

<span class="sd">    neighbors : dict</span>
<span class="sd">                of neighbors keyed by observation id</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Casting to floats is a work around for a bug in scipy.spatial.</span>
<span class="sd">        See detail in pysal issue #126.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">isKDTree</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kd</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kd</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">kd</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not make array from data&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">binary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_band</span><span class="p">()</span>
        <span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_distance_to_W</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">W</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_band</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find all pairs within threshold.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dmat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kd</span><span class="o">.</span><span class="n">sparse_distance_matrix</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kd</span><span class="p">,</span> <span class="n">max_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_distance_to_W</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ids</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dmat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,[])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">])</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">i</span><span class="p">,[])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">weight</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">weights</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">weighted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dmat</span><span class="p">))</span>
            <span class="k">print</span> <span class="n">weighted</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dmat</span><span class="o">.</span><span class="n">shape</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weighted</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                            <span class="n">weights</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weighted</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
                            <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">neighbors</span><span class="p">,</span> <span class="n">weights</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">w</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">z</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">timeit</span> DistanceBand(tree, threshold=9999, alpha=-1.5, binary=False)
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1 loop, best of 3: 7.73 s per loop
</pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">prun</span> DistanceBand(tree, threshold=9999, alpha=-1.5, binary=False)
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre> </pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="n">DistanceBand</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">pairs</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">dmat</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance_matrix</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">one</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>
<span class="n">two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="n">w</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">z</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))])</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="n">mat</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(500, 500)</pre>
</div>

</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> DistanceBand(tree, alpha=-1.5, binary=False)
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(500, 500)
CPU times: user 1.82 s, sys: 87 ms, total: 1.91 s
Wall time: 1.85 s
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;__main__.DistanceBand at 0x123f3c450&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="o">%</span><span class="k">time</span> Distance.DistanceBand(tree, threshold=9999999, alpha=-1.5, binary=False)
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 8.43 s, sys: 92.3 ms, total: 8.52 s
Wall time: 8.5 s
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;pysal.weights.Distance.DistanceBand at 0x123f38250&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">W_new</span> <span class="o">=</span> <span class="n">DistanceBand</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(500, 500)
</pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">W_old</span> <span class="o">=</span> <span class="n">Distance</span><span class="o">.</span><span class="n">DistanceBand</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">9999999</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">W_new</span><span class="o">.</span><span class="n">full</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">W_old</span><span class="o">.</span><span class="n">full</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>
</div>
</div>
</div>

</div>

 

