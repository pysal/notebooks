---
redirect_from:
  - "/model/spint/sparse-categorical-speed"
interact_link: content/model/spint/sparse_categorical_speed.ipynb
kernel_name: python2
has_widgets: false
title: 'sparse_categorical_speed'
prev_page:
  url: /model/spint/sparse_categorical_bottleneck.html
  title: 'sparse_categorical_bottleneck'
next_page:
  url: /model/spint/sparse_grav.html
  title: 'sparse_grav'
comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /content***"
---



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pysal</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="kn">as</span> <span class="nn">iter</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">f</span><span class="p">,</span> <span class="n">chisqprob</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">pylab</span> inline
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Populating the interactive namespace from numpy and matplotlib
</pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1">#OLD</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def spcategorical2(n_cat_ids):</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_cat_ids    : array</span>
<span class="sd">                   A 1d vector of the categorical labels for n observations.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy        : array</span>
<span class="sd">                   A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">                   categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
<span class="sd">    if np.squeeze(n_cat_ids).ndim == 1:</span>
<span class="sd">        cat_set = np.unique(n_cat_ids)</span>
<span class="sd">        n = len(n_cat_ids)</span>
<span class="sd">        C = len(cat_set)</span>
<span class="sd">        row_map = dict((id, np.where(cat_set == id)[0]) for id in n_cat_ids)</span>
<span class="sd">        indices = np.array([row_map[row] for row in n_cat_ids]).flatten()</span>
<span class="sd">        indptr = np.zeros((n + 1, ), dtype=int)</span>
<span class="sd">        indptr[:-1] = list(np.arange(n))</span>
<span class="sd">        indptr[-1] = n </span>
<span class="sd">        return sp.csr_matrix((np.ones(n), indices, indptr))</span>
<span class="sd">    else:</span>
<span class="sd">        raise IndexError(&quot;The index %s is not understood&quot; % col)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span> <span class="nf">spcategorical2</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_cat_ids    : array</span>
<span class="sd">                   A 1d vector of the categorical labels for n observations.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy        : array</span>
<span class="sd">                   A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">                   categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cat_set</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cat_set</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">n_cat_ids</span>
        <span class="n">indptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">indices</span><span class="p">,</span> <span class="n">indptr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The index </span><span class="si">%s</span><span class="s2"> is not understood&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">spcategorical1</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array</span>
<span class="sd">        A 1d vector of the categorical variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy_matrix</span>
<span class="sd">        A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">        categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">tmp_dummy</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">tmp_arr</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">each</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">tmp_dummy</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">tmp_dummy</span><span class="p">,</span> <span class="n">row</span><span class="p">])</span>
        <span class="n">tmp_dummy</span> <span class="o">=</span> <span class="n">tmp_dummy</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">tmp_dummy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The index </span><span class="si">%s</span><span class="s2"> is not understood&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">spcategorical1a</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array</span>
<span class="sd">        A 1d vector of the categorical variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy_matrix</span>
<span class="sd">        A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">        categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_arr</span><span class="p">)</span>
        <span class="n">tmp_dummy</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">dok_matrix</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">tmp_arr</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="n">each</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">tmp_dummy</span><span class="p">[:,</span><span class="n">each</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tmp_dummy</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The index </span><span class="si">%s</span><span class="s2"> is not understood&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">spcategorical1b</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array</span>
<span class="sd">        A 1d vector of the categorical variable.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy_matrix</span>
<span class="sd">        A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">        categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">tmp_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_arr</span><span class="p">)</span>
        <span class="n">tmp_dummy</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">lil_matrix</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">tmp_arr</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="n">each</span> <span class="o">==</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="n">tmp_dummy</span><span class="p">[:,</span><span class="n">each</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">tmp_dummy</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The index </span><span class="si">%s</span><span class="s2"> is not understood&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">spcategorical1</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">spcategorical2</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">spcategorical1</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">spcategorical1a</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
<span class="k">print</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">spcategorical1</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span> <span class="n">spcategorical1b</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>True
True
True
</pre>
</div>
</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">spcategorical1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat1</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">spcategorical1a</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat1a</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1b</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">spcategorical1b</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat1b</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">spcategorical2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1a</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1b</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat2</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">spcat1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">spcat1a</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">spcat1b</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">spcat2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;spcat1&#39;</span><span class="p">,</span> <span class="s1">&#39;spcat1a&#39;</span><span class="p">,</span> <span class="s1">&#39;spcat1b&#39;</span><span class="p">,</span> <span class="s1">&#39;spcat2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Speed of Sparse Dummy Functions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample Size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seconds&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h6 id="It-is-obvious-that-spcat1-and-spcat2-are-the-fastest-functions-for-creating-sparse-dummies.-The-differnece-between-these-two-functions-is-that-spcat1-creates-the-dummies-row-by-row-(in-sparse-format)-and-then-stacks-the-rows-using-sparse.hstack()-while-spcat2-builds-an-index-for-the-non-zero-dummy-variable-entries-and-then-uses-this-index-to-instanitate-the-entire-sparse-dummy-matrix,-somewhat-simularly-to-how-the-regimes-are-built-in-pysal.-The-slower-functions-spcat1a-and-spcat1b-are-riffs-on-spcat1-in-that-they-also-work-row-by-row-but-they-first-instantiate-an-empty-sparse-matrix-(either-lil-or-dok)-and-then-assign-the-rows-to-the-empty-matrix.-The-scipy-doucmentation-suggests-that-assignment-for-these-two-types-of-sparce-matrices-is-faster-than-csr-and-csc-and-therefore-is-better-for-incrementally-building-a-sparse-matrix.-However,-it-appears-that-avoiding-assignment-alother-may-be-the-best-route-if-building-a-sparse-matrix-row-by-row.-Therefrow-csr-is-the-best-sparse-data-structure-for-row-by-row-contruction-in-this-context.-Now-lets-lets-row-by-row-building-(spcat1)-vs-entire-instantiation-using-an-non-zero-value-index-(spcat2)-when-the-number-of-dummy-variables-starts-to-become-much-larger.">It is obvious that spcat1 and spcat2 are the fastest functions for creating sparse dummies. The differnece between these two functions is that spcat1 creates the dummies row by row (in sparse format) and then stacks the rows using sparse.hstack() while spcat2 builds an index for the non-zero dummy variable entries and then uses this index to instanitate the entire sparse dummy matrix, somewhat simularly to how the regimes are built in pysal. The slower functions spcat1a and spcat1b are riffs on spcat1 in that they also work row by row but they first instantiate an empty sparse matrix (either lil or dok) and then assign the rows to the empty matrix. The scipy doucmentation suggests that assignment for these two types of sparce matrices is faster than csr and csc and therefore is better for incrementally building a sparse matrix. However, it appears that avoiding assignment alother may be the best route if building a sparse matrix row by row. Therefrow csr is the best sparse data structure for row by row contruction in this context. Now lets lets row by row building (spcat1) vs entire instantiation using an non-zero-value index (spcat2) when the number of dummy variables starts to become much larger.<a class="anchor-link" href="#It-is-obvious-that-spcat1-and-spcat2-are-the-fastest-functions-for-creating-sparse-dummies.-The-differnece-between-these-two-functions-is-that-spcat1-creates-the-dummies-row-by-row-(in-sparse-format)-and-then-stacks-the-rows-using-sparse.hstack()-while-spcat2-builds-an-index-for-the-non-zero-dummy-variable-entries-and-then-uses-this-index-to-instanitate-the-entire-sparse-dummy-matrix,-somewhat-simularly-to-how-the-regimes-are-built-in-pysal.-The-slower-functions-spcat1a-and-spcat1b-are-riffs-on-spcat1-in-that-they-also-work-row-by-row-but-they-first-instantiate-an-empty-sparse-matrix-(either-lil-or-dok)-and-then-assign-the-rows-to-the-empty-matrix.-The-scipy-doucmentation-suggests-that-assignment-for-these-two-types-of-sparce-matrices-is-faster-than-csr-and-csc-and-therefore-is-better-for-incrementally-building-a-sparse-matrix.-However,-it-appears-that-avoiding-assignment-alother-may-be-the-best-route-if-building-a-sparse-matrix-row-by-row.-Therefrow-csr-is-the-best-sparse-data-structure-for-row-by-row-contruction-in-this-context.-Now-lets-lets-row-by-row-building-(spcat1)-vs-entire-instantiation-using-an-non-zero-value-index-(spcat2)-when-the-number-of-dummy-variables-starts-to-become-much-larger."> </a></h6>
</div>
</div>
</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">spcategorical1</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat1</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">spcategorical2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">spcat2</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">e</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat1</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">spcat2</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">spcat1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">spcat2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;spcat1&#39;</span><span class="p">,</span> <span class="s1">&#39;spcat2&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Speed of Sparse Dummy Functions&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Sample Size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Seconds&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h6 id="It-is-clear-that-the-spcat2-function,-which-uses-the-non-zero-value-index,-is-more-efficient-than-the-row-by-row-method-in-spcat1.-However,-from-additional-testing,-it-was-noticed-that-spcat2-does-use-more-memory-and-for-larger-n-(somewhere-between-10k-and-20k),-my-notebook-ran-out-of-memory.-This-is-likely-due-to-to-the-fact-that-the-spcat2-function-requires-an-($n^2$,)-array-ones-ones,-an-index-array-of-shape-($n^2$,)-and-an-index-pointer-array-of-shape-($n^2$,).-Combined-these-must-soak-up-a-lot-of-memory,-which-makes-very-large-n-infeasible.-Then-the-spcat1-function-still-may-be-useful-in-scenarios-where-there-is-a-very-large-sample-size-and-no-way-of-accessing-more-memory.-It-will-be-very-slow-in-compairson,-but-will-make-analysis-feasible-where-it-would-otherwise-be-infeasible.-As-a-reasult,--I-will-keep-both-functions-as-options.">It is clear that the spcat2 function, which uses the non-zero-value index, is more efficient than the row by row method in spcat1. However, from additional testing, it was noticed that spcat2 does use more memory and for larger n (somewhere between 10k and 20k), my notebook ran out of memory. This is likely due to to the fact that the spcat2 function requires an ($n^2$,) array ones ones, an index array of shape ($n^2$,) and an index pointer array of shape ($n^2$,). Combined these must soak up a lot of memory, which makes very large n infeasible. Then the spcat1 function still may be useful in scenarios where there is a very large sample size and no way of accessing more memory. It will be very slow in compairson, but will make analysis feasible where it would otherwise be infeasible. As a reasult,  I will keep both functions as options.<a class="anchor-link" href="#It-is-clear-that-the-spcat2-function,-which-uses-the-non-zero-value-index,-is-more-efficient-than-the-row-by-row-method-in-spcat1.-However,-from-additional-testing,-it-was-noticed-that-spcat2-does-use-more-memory-and-for-larger-n-(somewhere-between-10k-and-20k),-my-notebook-ran-out-of-memory.-This-is-likely-due-to-to-the-fact-that-the-spcat2-function-requires-an-($n^2$,)-array-ones-ones,-an-index-array-of-shape-($n^2$,)-and-an-index-pointer-array-of-shape-($n^2$,).-Combined-these-must-soak-up-a-lot-of-memory,-which-makes-very-large-n-infeasible.-Then-the-spcat1-function-still-may-be-useful-in-scenarios-where-there-is-a-very-large-sample-size-and-no-way-of-accessing-more-memory.-It-will-be-very-slow-in-compairson,-but-will-make-analysis-feasible-where-it-would-otherwise-be-infeasible.-As-a-reasult,--I-will-keep-both-functions-as-options."> </a></h6>
</div>
</div>
</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">concatenate_csc_matrices_by_columns</span><span class="p">(</span><span class="n">matrix1</span><span class="p">,</span> <span class="n">matrix2</span><span class="p">):</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">matrix1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">matrix2</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <span class="n">new_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">matrix1</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">matrix2</span><span class="o">.</span><span class="n">indices</span><span class="p">))</span>
    <span class="n">new_ind_ptr</span> <span class="o">=</span> <span class="n">matrix2</span><span class="o">.</span><span class="n">indptr</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix1</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">new_ind_ptr</span> <span class="o">=</span> <span class="n">new_ind_ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">new_ind_ptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">matrix1</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">new_ind_ptr</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">csc_matrix</span><span class="p">((</span><span class="n">new_data</span><span class="p">,</span> <span class="n">new_indices</span><span class="p">,</span> <span class="n">new_ind_ptr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">spcategorical2a</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a dummy matrix given an array of categorical variables.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_cat_ids    : array</span>
<span class="sd">                   A 1d vector of the categorical labels for n observations.</span>

<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dummy        : array</span>
<span class="sd">                   A sparse matrix of dummy (indicator/binary) variables for the</span>
<span class="sd">                   categorical data.  </span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">n_cat_ids</span><span class="p">)</span>
        <span class="n">indptr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint32</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int8</span><span class="p">),</span> <span class="n">n_cat_ids</span><span class="p">,</span> <span class="n">indptr</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The index </span><span class="si">%s</span><span class="s2"> is not understood&quot;</span> <span class="o">%</span> <span class="n">col</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>



</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">3500</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint16</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">b2</span> <span class="o">=</span> <span class="n">spcategorical2</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">print</span> <span class="n">e</span><span class="o">-</span><span class="n">s</span>
<span class="n">b2</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0:00:00.462530
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;12250000x3500 sparse matrix of type &#39;&lt;type &#39;numpy.float64&#39;&gt;&#39;
	with 12250000 stored elements in Compressed Sparse Row format&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>



<div class="cell border-box-sizing code_cell rendered">

<div class="jb_input" >
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">3500</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">uint16</span><span class="p">),</span><span class="n">n</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="n">b2a</span> <span class="o">=</span> <span class="n">spcategorical2a</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="k">print</span> <span class="n">e</span><span class="o">-</span><span class="n">s</span>
<span class="n">b2a</span>
</pre></div>

    </div>
</div>
</div>

</div>



<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper">
<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0:00:00.074958
</pre>
</div>
</div>
</div>
<div class="jb_output_wrapper">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;12250000x3500 sparse matrix of type &#39;&lt;type &#39;numpy.int8&#39;&gt;&#39;
	with 12250000 stored elements in Compressed Sparse Row format&gt;</pre>
</div>

</div>
</div>
</div>
</div>

</div>

 

